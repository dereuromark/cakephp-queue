
h1. CakePHP Queue Plugin

PHP5 - *CakePHP2.x*

h2. Background:

This is a modified version of the original Queue Plugin (1.2/1.3 only) from @MSeven.
Rewritten for 2.x it has also some enhancements added.

Note: Some of those enhancements require my Tools plugin (admin backend, email task, testing emails).

h2. Installation:

* Copy the files in this directory into your APP/Plugin/Queue
* Run the following command in the cake console to create the tables:
		@cake Schema run create -p Queue@
		
If you Installed the Queue Plugin in your global plugins directory instead of the app specific one, you will have to modify the -path parameter to point to the correct directory.
		
h2. Configuration:

The plugin allows some simple runtime configuration. 
You may create a file called "queue.php" inside your 'APP/config' folder (NOT the plugins config folder) to set the following values:

#seconds to sleep() when no executable job is found
@$config['queue']['sleeptime'] = 10;@

#Propability in percent of a old job cleanup happening
@$config['queue']['gcprop'] = 10;@

#Default timeout after which a job is requeued if the worker doesn't report back
@$config['queue']['defaultworkertimeout'] = 120;@

#Default number of retries if a job fails or times out.
@$config['queue']['defaultworkerretries'] = 4;@

#Seconds of runnig time after which the worker will terminate (0 = unlimited)
@$config['queue']['workermaxruntime'] = 0;@

#Should a Workerprocess quit when there are no more tasks for it to execute (true = exit, false = keep running)
@$config['queue']['exitwhennothingtodo] = false@

The values above are the default settings which apply, when no configuration is found.

h2. Usage:

Run the following using the cakephp shell:

@cake Queue help@
* Display Help message
          
@cake Queue add <taskname>@  
* Try to call the cli add() function on a task
* tasks may or may not provide this functionality.
@cake Queue runworker@  
* run a queue worker, which will look for a pending task it can execute.
* the worker will always try to find jobs matching its installed Tasks
         
*Notes:*
	_<taskname>_ may either be the complete classname (eg. QueueExample)	or the shorthand without the leading "Queue" (eg. Example)
        
Use '@cake queue help@' to get a list of installed/available tasks.

Custom tasks should be placed in APP/Console/Command/Task.
Tasks should be named `QueueSomethingTask.php` and implement a "QueueSomethingTask", keeping Cakephp Naming conventions intact.

A detailed Example task can be found in /Console/Command/Task/QueueExampleTask.php inside this folder.
